                                Release Summary

                                asterisk-18.2.0

                                Date: 2021-01-21

                           <asteriskteam@digium.com>

     ----------------------------------------------------------------------

                               Table of Contents

    1. Summary
    2. Contributors
    3. Closed Issues
    4. Open Issues
    5. Other Changes
    6. Diffstat

     ----------------------------------------------------------------------

                                    Summary

                                 [Back to Top]

   This release is a point release of an existing major version. The changes
   included were made to address problems that have been identified in this
   release series, or are minor, backwards compatible new features or
   improvements. Users should be able to safely upgrade to this version if
   this release series is already in use. Users considering upgrading from a
   previous version are strongly encouraged to review the UPGRADE.txt
   document as well as the CHANGES document for information about upgrading
   to this release series.

   The data in this summary reflects changes that have been made since the
   previous release, asterisk-18.1.0.

     ----------------------------------------------------------------------

                                  Contributors

                                 [Back to Top]

   This table lists the people who have submitted code, those that have
   tested patches, as well as those that reported issues on the issue tracker
   that were resolved in this release. For coders, the number is how many of
   their patches (of any size) were committed into this release. For testers,
   the number is the number of times their name was listed as assisting with
   testing a patch. Finally, for reporters, the number is the number of
   issues that they reported that were affected by commits that went into
   this release.

   Coders                      Testers          Reporters                     
   6 Sean Bright               1 Mark Petersen  4 Alexander Traud             
   4 Alexander Traud                            2 Sean Bright                 
   3 George Joseph                              2 sungtae kim                 
   3 Joshua C. Colp                             2 George Joseph               
   2 Kevin Harwell                              1 Flole Systems               
   2 Asterisk Development Team                  1 Michael Maier               
   2 Ivan Poddubnyi                             1 Ivan Poddubny               
   2 Jaco Kroon                                 1 Julien                      
   2 Richard Mudgett                            1 Jaco Kroon                  
   2 Sungtae Kim                                1 Jean Aunis - Prescom        
   1 Dan Cropp                                  1 Hendrik Wedhorn             
   1 Boris P. Korzun                            1 Alexander Traud             
   1 Jean Aunis                                 1 N GM                        
   1 Stanislav                                  1 Robert Sutton               
   1 Torrey Searle                              1 Alex Hermann                
   1 Alexander Greiner-Baer                     1 Alex Hermann                
   1 laszlovl                                   1 Juan Carlos Castro y Castro 
   1 Nick French                                1 Boris P. Korzun             
   1 Pirmin Walthert                            1 Alexander Greiner-Baer      
   1 Nathan Bruning                             1 Schneur Rosenberg           
   1 Mark Petersen                              1 Mark Petersen               
                                                1 Dan Cropp                   
                                                1 Nathan Bruning              
                                                1 Dalius Mockevicius          
                                                1 Mark Petersen               
                                                1 Michael Maier               
                                                1 Gant Liu                    
                                                1 Dan Cropp                   
                                                1 Stanislav Abramenkov        
                                                1 Torrey Searle               
                                                1 laszlovl                    
                                                1 Mikhail Ivanov              

     ----------------------------------------------------------------------

                                 Closed Issues

                                 [Back to Top]

   This is a list of all issues from the issue tracker that were closed by
   changes that went into this release.

  Security

    Category: Resources/res_pjsip_diversion

   ASTERISK-29219: res_pjsip_diversion: Crash if Tel URI contains
   History-Info
   Reported by: Torrey Searle
     * [a7aea71e60] Torrey Searle -- res/res_pjsip_diversion: prevent crash
       on tel: uri in History-Info

  Bug

    Category: Applications/app_chanspy

   ASTERISK-28883: Spyee information ist missing in ChanSpyStop AMI Event
   Reported by: Hendrik Wedhorn
     * [13682210e2] Sean Bright -- app_chanspy: Spyee information missing in
       ChanSpyStop AMI Event

    Category: Applications/app_mixmonitor

   ASTERISK-28947: Segmentation fault in mixmonitor_ds_destroy
   Reported by: Robert Sutton
     * [0e1ba9a778] Kevin Harwell -- app_mixmonitor: cleanup datastore when
       monitor thread fails to launch

    Category: Applications/app_queue

   ASTERISK-29155: app_queue: Deadlock between queues container and
   individual queues
   Reported by: George Joseph
     * [2413598705] George Joseph -- app_queue: Fix deadlock between update
       and show queues

    Category: Bridges/bridge_simple

   ASTERISK-29161: Incorrect setup of recall channels
   Reported by: Boris P. Korzun
     * [33e3542132] Boris P. Korzun -- bridge_basic: Fixed setup of recall
       channels

    Category: CDR/General

   ASTERISK-29168: Asterisk crashes during call transfer
   Reported by: Dalius Mockevicius
     * [d9aef0e6e5] Kevin Harwell -- pbx_realtime: wrong type stored on
       publish of ast_channel_snapshot_type

    Category: Channels/chan_pjsip

   ASTERISK-29240: chan_pjsip: Incoming PJSIP calls set global SIPDOMAIN
   instead of a channel variable
   Reported by: Ivan Poddubny
     * [c3fad2fd01] Ivan Poddubnyi -- chan_pjsip: Assign SIPDOMAIN after
       creating a channel
   ASTERISK-27902: chan_pjsip isn't updating hangupcause on 4XX responses
   Reported by: George Joseph
     * [cc496044db] Ivan Poddubnyi -- chan_pjsip: Stop queueing control
       frames twice on outgoing channels
   ASTERISK-28016: PJSIP sends duplicate 183 Progress responses
   Reported by: Alex Hermann
     * [cc496044db] Ivan Poddubnyi -- chan_pjsip: Stop queueing control
       frames twice on outgoing channels
   ASTERISK-28185: chan_pjsip: Subsequent same responses are not stopped
   Reported by: Julien
     * [cc496044db] Ivan Poddubnyi -- chan_pjsip: Stop queueing control
       frames twice on outgoing channels
   ASTERISK-29230: pjsip: Asterisk goes crazy and massively spams logfile if
   registration can't be send
   Reported by: Michael Maier
     * [b3927ff8bc] George Joseph -- Revert
       "res_pjsip_outbound_registration.c: Use our own scheduler and other
       stuff"
   ASTERISK-29201: Crash occurs when Transfer and execute Hangup before the
   Transfer result
   Reported by: Dan Cropp
     * [fb23f98521] Dan Cropp -- chan_pjsip: Incorporate channel reference
       count into transfer_refer().
   ASTERISK-29210: res_pjsip: Crash when examining transport
   Reported by: N GM
     * [3c8598ffef] Nick French -- res_pjsip: Prevent segfault in UDP
       registration with flow transports
   ASTERISK-29022: Crash when manipulating PJSIP invite dlg ref counts
   Reported by: Sean Bright
     * [5b4e71fa0a] Joshua C. Colp -- pjsip: Match lifetime of INVITE session
       to our session.

    Category: Channels/chan_sip/CodecHandling

   ASTERISK-29238: chan_sip: SDP: Offers without any enabled stream are
   accepted.
   Reported by: Alexander Traud
     * [ad606d4ad1] Alexander Traud -- chan_sip: SDP: Sidestep stream parsing
       when its media is disabled.
   ASTERISK-29237: chan_sip: SDP: m=video is parsed even when disabled.
   Reported by: Alexander Traud
     * [ad606d4ad1] Alexander Traud -- chan_sip: SDP: Sidestep stream parsing
       when its media is disabled.

    Category: Channels/chan_sip/SRTP

   ASTERISK-29222: chan_sip: Hold/Resume an sRTP call on a video enabled
   user-agent.
   Reported by: Alexander Traud
     * [ad606d4ad1] Alexander Traud -- chan_sip: SDP: Sidestep stream parsing
       when its media is disabled.

    Category: Channels/chan_sip/TCP-TLS

   ASTERISK-28798: [patch] chan_sip: TCP/TLS client without server.
   Reported by: Alexander Traud
     * [e884d935f6] Alexander Traud -- chan_sip: Remove unused
       sip_socket->port.

    Category: Channels/chan_sip/Video

   ASTERISK-29238: chan_sip: SDP: Offers without any enabled stream are
   accepted.
   Reported by: Alexander Traud
     * [ad606d4ad1] Alexander Traud -- chan_sip: SDP: Sidestep stream parsing
       when its media is disabled.
   ASTERISK-29237: chan_sip: SDP: m=video is parsed even when disabled.
   Reported by: Alexander Traud
     * [ad606d4ad1] Alexander Traud -- chan_sip: SDP: Sidestep stream parsing
       when its media is disabled.

    Category: Core/Logging

   ASTERISK-29209: Debug messages printed by scope trace might be missing
   newlines
   Reported by: Alexander Traud
     * [ccb4951bf8] George Joseph -- logger.c: Automatically add a newline to
       formats that don't have one

    Category: Functions/func_lock

   ASTERISK-29217: LOCK() can grant the same lock to multiple channels
   spuriously
   Reported by: Jaco Kroon
     * [3a230cc6a9] Jaco Kroon -- func_lock: fix multiple-channel-grant
       problems.

    Category: General

   ASTERISK-29148: AST_MODULE_INFO no, MODULEINFO depend
   Reported by: Alexander Traud
     * [bf9f0f13c4] Alexander Traud -- loader: Sync load- and build-time
       deps.

    Category: Resources/res_ari_channels

   ASTERISK-29188: null media causing the Asterisk crash
   Reported by: sungtae kim
     * [4b450b4334] Sungtae Kim -- res_ari: Fix wrong media uri handle for
       channel play

    Category: Resources/res_http_media_cache

   ASTERISK-29173: Media cache URL requests allow infinite redirects
   Reported by: Sean Bright
     * [f39d5ea7cd] Sean Bright -- res_http_media_cache.c: Set reasonable
       number of redirects

    Category: Resources/res_musiconhold

   ASTERISK-29211: res_musiconhold: Segfault on realtime music on hold
   without entries
   Reported by: Nathan Bruning
     * [0774d9f9aa] Nathan Bruning -- res_musiconhold: Don't crash when
       real-time doesn't return any entries

    Category: Resources/res_pjsip

   ASTERISK-29165: res_pjsip: malformed header Accept-Encoding in OPTIONS
   response
   Reported by: Alexander Greiner-Baer
     * [c79bd583d9] Alexander Greiner-Baer -- res_pjsip: set Accept-Encoding
       to identity in OPTIONS response

    Category: Resources/res_pjsip_diversion

   ASTERISK-29191: tel: URI in Diversion header causes crash
   Reported by: Mikhail Ivanov
     * [a7aea71e60] Torrey Searle -- res/res_pjsip_diversion: prevent crash
       on tel: uri in History-Info

    Category: Resources/res_pjsip_outbound_registration

   ASTERISK-29231: pjsip: SIGSEGV in CLI if no trunk is registered
   Reported by: Michael Maier
     * [b3927ff8bc] George Joseph -- Revert
       "res_pjsip_outbound_registration.c: Use our own scheduler and other
       stuff"

    Category: Resources/res_pjsip_session

   ASTERISK-29240: chan_pjsip: Incoming PJSIP calls set global SIPDOMAIN
   instead of a channel variable
   Reported by: Ivan Poddubny
     * [c3fad2fd01] Ivan Poddubnyi -- chan_pjsip: Assign SIPDOMAIN after
       creating a channel

    Category: Resources/res_stasis

   ASTERISK-29229: Stasis/messaging: text messages not dispatched to all
   subscribers when using generic subscription
   Reported by: Jean Aunis - Prescom
     * [c10557c401] Jean Aunis -- Stasis/messaging: tech subscriptions
       conflict with endpoint subscriptions.

    Category: Resources/res_stir_shaken

   ASTERISK-29175: res_pjsip_stir_shaken: Fix module description
   Reported by: Stanislav Abramenkov
     * [6a85dc860f] Stanislav -- res_pjsip_stir_shaken: Fix module
       description

    Category: pjproject/pjsip

   ASTERISK-29191: tel: URI in Diversion header causes crash
   Reported by: Mikhail Ivanov
     * [a7aea71e60] Torrey Searle -- res/res_pjsip_diversion: prevent crash
       on tel: uri in History-Info
   ASTERISK-29024: pjsip: Route Header in Cancel request incorrectly set
   Reported by: Flole Systems
     * [7a6cfde4db] Pirmin Walthert -- res_pjsip_nat.c: Create deep copies of
       strings when appropriate

  Improvement

    Category: Applications/app_voicemail/NewFeature

   ASTERISK-29118: VoiceMail() should have an option to play greetings as
   Early Media
   Reported by: Juan Carlos Castro y Castro
     * [fd57fae048] Joshua C. Colp -- voicemail: add option 'e' to play
       greetings as early media

    Category: Channels/chan_pjsip

   ASTERISK-28549: Two repeated 183
   Reported by: Gant Liu
     * [cc496044db] Ivan Poddubnyi -- chan_pjsip: Stop queueing control
       frames twice on outgoing channels

    Category: Contrib/General

   ASTERISK-29216: contrib: systemd asterisk service for centos8 or other
   newer linux versions
   Reported by: Mark Petersen
     * [cba8426b4c] Mark Petersen -- contrib/systemd: Added note on common
       issues with systemd and asterisk

    Category: Resources/res_http_media_cache

   ASTERISK-29143: res_http_media_cache: HTTP media cache stored hardcoded in
   /tmp
   Reported by: laszlovl
     * [92fcd4edba] laszlovl -- Introduce astcachedir, to be used for
       temporary bucket files

    Category: Resources/res_pjsip_session

   ASTERISK-28549: Two repeated 183
   Reported by: Gant Liu
     * [cc496044db] Ivan Poddubnyi -- chan_pjsip: Stop queueing control
       frames twice on outgoing channels

     ----------------------------------------------------------------------

                                  Open Issues

                                 [Back to Top]

   This is a list of all open issues from the issue tracker that were
   referenced by changes that went into this release.

  Bug

    Category: Applications/app_voicemail/ODBC

   ASTERISK-28992: app_voicemail: Deadlock in ODBC when retrieving file
   Reported by: Schneur Rosenberg
     * [9ff548f1db] Sean Bright -- app_voicemail: Prevent deadlocks when out
       of ODBC database connections

    Category: Resources/res_pjsip_session

   ASTERISK-29215: res_pjsip_session: NULL active_media_state topology caused
   asterisk crash
   Reported by: sungtae kim
     * [d8b7a6f599] Sungtae Kim -- res_pjsip_session: Fixed NULL active media
       topology handle

     ----------------------------------------------------------------------

                      Commits Not Associated with an Issue

                                 [Back to Top]

   This is a list of all changes that went into this release that did not
   reference a JIRA issue.

   +------------------------------------------------------------------------+
   | Revision   | Author      | Summary                                     |
   |------------+-------------+---------------------------------------------|
   |            | Asterisk    |                                             |
   | d4524449d9 | Development | Update for 18.2.0-rc1                       |
   |            | Team        |                                             |
   |------------+-------------+---------------------------------------------|
   |            | Asterisk    |                                             |
   | 89fea9bafe | Development | Update CHANGES and UPGRADE.txt for 18.2.0   |
   |            | Team        |                                             |
   |------------+-------------+---------------------------------------------|
   | 49f625b8db | Jaco Kroon  | pbx_lua: Add LUA_VERSIONS environment       |
   |            |             | variable to ./configure.                    |
   |------------+-------------+---------------------------------------------|
   | 68d3d3af6f | Sean Bright | asterisk: Export additional manager         |
   |            |             | functions                                   |
   |------------+-------------+---------------------------------------------|
   | 3d379845e6 | Richard     | chan_vpb.cc: Fix compile errors.            |
   |            | Mudgett     |                                             |
   |------------+-------------+---------------------------------------------|
   | 027f4e3a21 | Richard     | res_pjsip_session.c: Fix compiler warnings. |
   |            | Mudgett     |                                             |
   |------------+-------------+---------------------------------------------|
   | 938a240793 | Joshua C.   | res_pjsip_pidf_digium_body_supplement:      |
   |            | Colp        | Support Sangoma user agent.                 |
   |------------+-------------+---------------------------------------------|
   | f9438e6457 | Sean Bright | media_cache: Fix reference leak with bucket |
   |            |             | file metadata                               |
   |------------+-------------+---------------------------------------------|
   | 994fbdaf48 | Sean Bright | CHANGES: Remove already applied CHANGES     |
   |            |             | update                                      |
   |------------+-------------+---------------------------------------------|
   | 6e1fb58183 | Alexander   | modules.conf: Align the comments for more   |
   |            | Traud       | conclusiveness.                             |
   +------------------------------------------------------------------------+

     ----------------------------------------------------------------------

                                Diffstat Results

                                 [Back to Top]

   This is a summary of the changes to the source code that went into this
   release that was generated using the diffstat utility.

 asterisk-18.1.0-summary.html                                                          |  188 ---
 asterisk-18.1.0-summary.txt                                                           |  499 --------
 b/.version                                                                            |    2
 b/CHANGES                                                                             |   18
 b/ChangeLog                                                                           |  555 +++++++++-
 b/Makefile                                                                            |    6
 b/apps/app_chanspy.c                                                                  |    6
 b/apps/app_mixmonitor.c                                                               |   23
 b/apps/app_queue.c                                                                    |  245 ++--
 b/apps/app_voicemail.c                                                                |   36
 b/asterisk-18.2.0-rc1-summary.html                                                    |  171 +++
 b/asterisk-18.2.0-rc1-summary.txt                                                     |  510 +++++++++
 b/build_tools/install_subst                                                           |    1
 b/build_tools/make_defaults_h                                                         |    1
 b/build_tools/mkpkgconfig                                                             |    1
 b/channels/chan_pjsip.c                                                               |  214 +--
 b/channels/chan_sip.c                                                                 |   32
 b/channels/chan_vpb.cc                                                                |    2
 b/channels/sip/include/sip.h                                                          |    2
 b/configs/basic-pbx/modules.conf                                                      |    8
 b/configs/samples/asterisk.conf.sample                                                |    1
 b/configs/samples/modules.conf.sample                                                 |   21
 b/configure                                                                           |   11
 b/configure.ac                                                                        |    9
 b/contrib/systemd/asterisk.service                                                    |    7
 b/funcs/func_lock.c                                                                   |  163 +-
 b/funcs/func_odbc.c                                                                   |    1
 b/funcs/func_periodic_hook.c                                                          |    1
 b/include/asterisk/manager.h                                                          |    4
 b/include/asterisk/paths.h                                                            |    1
 b/main/asterisk.c                                                                     |    4
 b/main/bridge_basic.c                                                                 |    2
 b/main/bucket.c                                                                       |    3
 b/main/logger.c                                                                       |    5
 b/main/manager.c                                                                      |    6
 b/main/manager_channels.c                                                             |   18
 b/main/media_cache.c                                                                  |    1
 b/main/options.c                                                                      |    7
 b/main/pbx_variables.c                                                                |    2
 b/makeopts.in                                                                         |    1
 b/pbx/pbx_realtime.c                                                                  |   32
 b/res/res_hep_pjsip.c                                                                 |    2
 b/res/res_http_media_cache.c                                                          |    1
 b/res/res_musiconhold.c                                                               |   21
 b/res/res_odbc.c                                                                      |    1
 b/res/res_pjproject.c                                                                 |    2
 b/res/res_pjsip.c                                                                     |    2
 b/res/res_pjsip/pjsip_message_filter.c                                                |    3
 b/res/res_pjsip/pjsip_options.c                                                       |    2
 b/res/res_pjsip_diversion.c                                                           |   11
 b/res/res_pjsip_dlg_options.c                                                         |    2
 b/res/res_pjsip_nat.c                                                                 |   10
 b/res/res_pjsip_outbound_registration.c                                               |  286 ++---
 b/res/res_pjsip_pidf_digium_body_supplement.c                                         |    8
 b/res/res_pjsip_session.c                                                             |   67 -
 b/res/res_pjsip_stir_shaken.c                                                         |    4
 b/res/res_pjsip_transport_websocket.c                                                 |    2
 b/res/res_prometheus.c                                                                |    4
 b/res/res_stasis_playback.c                                                           |    7
 b/res/res_stasis_snoop.c                                                              |   12
 b/res/stasis/messaging.c                                                              |   58 -
 b/tests/test_http_media_cache.c                                                       |    1
 b/third-party/pjproject/patches/0070-fix-incorrect-copying-when-creating-cancel.patch |   19
 doc/CHANGES-staging/hide_messaging_ami_events                                         |   11
 64 files changed, 1959 insertions(+), 1397 deletions(-)
